{"version":3,"file":"component.bundle.js","sources":["../src/IconFile.js","../src/IconLock.js","../src/component.js"],"sourcesContent":["export const IconFile = {\r\n  template: `\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"17.383\" height=\"24\" viewBox=\"0 0 17.383 24\" >\r\n      <g transform=\"translate(-4.461)\">\r\n        <g transform=\"translate(4.461)\">\r\n          <g>\r\n            <path d=\"M21.844,6.573v15.88A1.547,1.547,0,0,1,20.3,24H6.008a1.546,1.546,0,0,1-1.547-1.547V1.547A1.546,1.546,0,0,1,6.008,0H15.27Z\" transform=\"translate(-4.461)\" class=\"a\"/>\r\n          </g>\r\n          <path d=\"M20.036,8.289l5.677,2.339v-2.2l-3.218-.951Z\" transform=\"translate(-8.33 -1.858)\" class=\"b\"/>\r\n          <path d=\"M25.416,6.573H20.389a1.546,1.546,0,0,1-1.547-1.547V0Z\" transform=\"translate(-8.033)\" class=\"c\"/>\r\n        </g>\r\n        <path d=\"M18.117,19.012l-2.85-2.85a.555.555,0,0,0-.785,0l-2.85,2.85a.555.555,0,0,0,.785.784l1.9-1.9v5.024a.555.555,0,1,0,1.109,0V17.894l1.9,1.9a.555.555,0,0,0,.785-.784Z\" transform=\"translate(-1.741 -3.974)\" class=\"d\"/>\r\n      </g>\r\n    </svg>\r\n  `,\r\n};\r\n","export const IconLock = {\r\n  template: `\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"16\" viewBox=\"0 0 12 16\" fill=\"none\">\r\n      <path d=\"M2.25 5.66667V5C2.25 2.78413 3.92262 1 6 1C8.07738 1 9.75 2.78413 9.75 5V5.66667M2.25 5.66667C1.5625 5.66667 1 6.26667 1 7V13.6667C1 14.4 1.5625 15 2.25 15H9.75C10.4375 15 11 14.4 11 13.6667V7C11 6.26667 10.4375 5.66667 9.75 5.66667M2.25 5.66667H9.75\" stroke=\"#9B9B9B\" stroke-width=\"1.5\" stroke-linecap=\"round\"/>\r\n    </svg>\r\n  `,\r\n};\r\n","import './component.css';\r\n\r\nimport { IconFile } from './IconFile';\r\nimport { IconLock } from './IconLock.js';\r\n\r\nexport const ControlFile = {\r\n  data() {\r\n    return {\r\n      controlId: this.id || this.control.id || null,\r\n      controlName: this.name || this.control.name || null,\r\n      focused: false,\r\n      blured: false,\r\n      warning: '',\r\n      active: true,\r\n      files: [],\r\n      default: '<a href=\"\">Выберите файл</a>&nbsp;или перетащите в поле',\r\n      hint: this.control.hint_external,\r\n    };\r\n  },\r\n  props: ['control', 'id', 'name'],\r\n  components: {\r\n    IconFile,\r\n    IconLock,\r\n  },\r\n  // language=Vue\r\n  template: `\r\n\t\t<div\r\n    :class=\"{\r\n      'twpx-form-control': true,\r\n      'twpx-form-control--file': true,\r\n      'twpx-form-control--active': active,\r\n      'twpx-form-control--invalid': invalid,\r\n      'twpx-form-control--disabled': disabled,\r\n    }\"\r\n  >\r\n    <IconLock\r\n      class=\"twpx-form-control__file__disabled-icon\"\r\n      v-if=\"disabled\"\r\n    />\r\n    <span\r\n      class=\"twpx-form-control__file__clear\"\r\n      @click.prevent=\"clearInputFile\"\r\n      v-if=\"isClearable\"\r\n    ></span>\r\n    <div\r\n      class=\"twpx-form-control__file\"\r\n      :class=\"{\r\n        filled: isFilled,\r\n        clearable: isClearable,\r\n      }\"\r\n      ref=\"controlFile\"\r\n    >\r\n      <span class=\"twpx-form-control__file__label\">{{ control.label }}</span>\r\n\r\n      <IconFile class=\"twpx-form-control__file__icon\" />\r\n\r\n      <input\r\n        type=\"file\"\r\n        :name=\"control.name\"\r\n        :id=\"control.id\"\r\n        @change=\"uploadFile($refs.inputFile.files)\"\r\n        ref=\"inputFile\"\r\n      />\r\n      <label\r\n        :for=\"control.id\"\r\n        class=\"active\"\r\n        v-html=\"label\"\r\n        ref=\"dropzone\"\r\n      ></label>\r\n    </div>\r\n    <div class=\"twpx-form-control__hint\" v-html=\"hint\" v-if=\"hint\"></div>\r\n  </div>\r\n\t`,\r\n  emits: ['input', 'focus', 'blur', 'enter'],\r\n  computed: {\r\n    disabled() {\r\n      return this.control.disabled;\r\n    },\r\n    invalid() {\r\n      return !!this.invalidString;\r\n    },\r\n    isClearable() {\r\n      return !!this.filename;\r\n    },\r\n    isFilled() {\r\n      return !!this.filename;\r\n    },\r\n    invalidString() {\r\n      if (this.files[0] && this.files[0].size && this.files[0].name) {\r\n        if (this.files[0].size >= this.control.maxsize) {\r\n          //this.files = [];\r\n          return `Размер файла превышает ${this.formatSize(\r\n            this.control.maxsize\r\n          )}`;\r\n        }\r\n\r\n        const filename = this.files[0].name;\r\n        const lastIndex = filename.lastIndexOf('.');\r\n        const regExp = new RegExp(this.control.accept.join('|'));\r\n\r\n        if (!regExp.test(filename.substring(lastIndex + 1).toLowerCase())) {\r\n          return `Прикладывайте файлы ${this.control.accept\r\n            .map((w) => w.toUpperCase())\r\n            .join(', ')}.`;\r\n        }\r\n      }\r\n      return '';\r\n    },\r\n    label() {\r\n      if (this.invalid) {\r\n        return this.invalidString;\r\n      }\r\n      if (this.files[0] && this.files[0].name) {\r\n        return this.files[0].name;\r\n      }\r\n      if (this.control.value) {\r\n        return this.control.value;\r\n      }\r\n      return this.default;\r\n    },\r\n    filename() {\r\n      return this.control.value;\r\n    },\r\n    clearWatcher() {\r\n      return this.control.clearWatcher;\r\n    },\r\n  },\r\n  watch: {\r\n    clearWatcher() {\r\n      this.clearInputFile();\r\n    },\r\n  },\r\n  methods: {\r\n    uploadFile(files) {\r\n      this.files = files;\r\n      if (!this.invalidString) {\r\n        this.$emit('input', { value: files[0].name, file: files[0] });\r\n      }\r\n    },\r\n    clearInputFile() {\r\n      this.files = [];\r\n      this.$refs.inputFile.value = '';\r\n      this.$emit('input', { value: '', file: null });\r\n    },\r\n    cancelEvent(e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      return false;\r\n    },\r\n    getCoords(elem) {\r\n      let box = elem.getBoundingClientRect();\r\n\r\n      return {\r\n        top: box.top + scrollY,\r\n        left: box.left + scrollX,\r\n      };\r\n    },\r\n    formatSize(length) {\r\n      var i = 0,\r\n        type = ['б', 'Кб', 'Мб', 'Гб', 'Тб', 'Пб'];\r\n      while ((length / 1000) | 0 && i < type.length - 1) {\r\n        length /= 1000;\r\n        i++;\r\n      }\r\n      return parseInt(length) + ' ' + type[i];\r\n    },\r\n  },\r\n  mounted() {\r\n    //drag&drop file\r\n    const dropZone = this.$refs.dropzone;\r\n    const controlFile = this.$refs.controlFile;\r\n    if (!dropZone) {\r\n      return;\r\n    }\r\n    dropZone.addEventListener('drag', this.cancelEvent);\r\n    dropZone.addEventListener('dragstart', this.cancelEvent);\r\n    dropZone.addEventListener('dragend', this.cancelEvent);\r\n    dropZone.addEventListener('dragover', this.cancelEvent);\r\n    dropZone.addEventListener('dragenter', this.cancelEvent);\r\n    dropZone.addEventListener('dragleave', this.cancelEvent);\r\n    dropZone.addEventListener('drop', this.cancelEvent);\r\n\r\n    dropZone.addEventListener('dragover', () => {\r\n      controlFile.classList.add('dragover');\r\n    });\r\n    dropZone.addEventListener('dragenter', () => {\r\n      controlFile.classList.add('dragover');\r\n    });\r\n    dropZone.addEventListener('dragleave', (e) => {\r\n      let dx = e.pageX - this.getCoords(dropZone).left;\r\n      let dy = e.pageY - this.getCoords(dropZone).top;\r\n      if (\r\n        dx < 0 ||\r\n        dx > dropZone.clientWidth ||\r\n        dy < 0 ||\r\n        dy > dropZone.clientHeight\r\n      ) {\r\n        controlFile.classList.remove('dragover');\r\n      }\r\n    });\r\n\r\n    dropZone.addEventListener('drop', (e) => {\r\n      controlFile.classList.remove('dragover');\r\n      this.uploadFile(e.dataTransfer.files);\r\n    });\r\n  },\r\n};\r\n"],"names":["IconFile","template","IconLock","ControlFile","data","controlId","id","control","controlName","name","focused","blured","warning","active","files","hint","hint_external","props","components","emits","computed","disabled","invalid","invalidString","isClearable","filename","isFilled","size","maxsize","formatSize","lastIndex","lastIndexOf","regExp","RegExp","accept","join","test","substring","toLowerCase","map","w","toUpperCase","label","value","clearWatcher","watch","clearInputFile","methods","uploadFile","$emit","file","$refs","inputFile","cancelEvent","e","preventDefault","stopPropagation","getCoords","elem","box","getBoundingClientRect","top","scrollY","left","scrollX","length","i","type","parseInt","mounted","dropZone","dropzone","controlFile","addEventListener","classList","add","dx","pageX","dy","pageY","clientWidth","clientHeight","remove","dataTransfer"],"mappings":"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"}
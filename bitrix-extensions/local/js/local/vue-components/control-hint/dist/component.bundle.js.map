{"version":3,"file":"component.bundle.js","sources":["../src/component.js"],"sourcesContent":["import './component.css';\n\nexport const ControlHint = {\n  data() {\n    return {\n      controlId: this.id || this.control.id || null,\n      controlName: this.name || this.control.name || null,\n      focused: false,\n      blured: false,\n      warning: '',\n      hint: this.control.hint_external,\n\n      controlValue: this.control.value,\n      hintItems: [],\n      activeHintItem: {},\n      activeHint: [],\n      hover: false,\n      compare: this.controlValue,\n    };\n  },\n  props: ['control', 'id', 'name'],\n  // language=Vue\n  template: `\n\t\t<div\n      :class=\"{\n        'twpx-form-control': true,\n        'twpx-form-control--text': true,\n        'twpx-form-control--active': active,\n        'twpx-form-control--invalid': invalid,\n        'twpx-form-control--disabled': disabled,\n      }\"\n    >\n      <img\n        :src=\"disabled\"\n        class=\"twpx-form-control__disabled-icon\"\n        v-if=\"false\"\n      />\n\n      <div class=\"twpx-form-control__label\">{{ control.label }}</div>\n      \n      <input\n        type=\"text\"\n        :id=\"controlId\"\n        :name=\"controlName\"\n        v-model=\"controlValue\"\n        @focus=\"focus\"\n        @blur=\"blur\"\n        @keydown.enter.prevent=\"enterInput\"\n        @keydown.up.prevent=\"upArrow()\"\n        @keydown.down.prevent=\"downArrow()\"\n        :disabled=\"disabled\"\n        ref=\"input\"\n        autocomplete=\"off\"\n        :placeholder=\"placeholder\"\n        class=\"twpx-form-control__input\"\n      />\n\n      <div class=\"b-input-clear\" @click.prevent=\"clearInput()\" v-show=\"isClearable\"></div>\n\n      <div class=\"b-input-hint\">\n        <div v-for=\"(hint, index) in hintItems\" :data-id=\"hint.id\" :data-value=\"hint.value\" :class=\"{active: activeHint[index]}\" class=\"b-input-hint__item\" @click.prevent=\"clickHint($event)\"></div>\n      </div>\n\n      <div\n        class=\"twpx-form-control__warning\"\n        v-html=\"warning\"\n        v-if=\"warning\"\n      ></div>\n\n      <div class=\"twpx-form-control__hint\" v-html=\"hint\" v-if=\"hint\"></div>\n    </div>\n\t`,\n  emits: ['input'],\n  computed: {\n    placeholder() {\n      if (this.focused && !this.value.trim()) {\n        return this.control.hint_internal;\n      } else {\n        return '';\n      }\n    },\n    active() {\n      return this.focused || !!this.control.value.trim();\n    },\n    invalid() {\n      return this.blured && !this.validate();\n    },\n    disabled() {\n      return this.control.disabled;\n    },\n    validateWatcher() {\n      return this.control.validateWatcher;\n    },\n    focusWatcher() {\n      return this.control.focusWatcher;\n    },\n    isClearable() {\n      return this.controlValue !== '' && this.hover ? true : false;\n    },\n  },\n  watch: {\n    // controlValue(value) {\n    //   this.change(value);\n    //   get() {\n    //     return this.control.value;\n    //   },\n    //   set(value) {\n    //     this.change(value);\n    //     // this.$emit('input', { value });\n    //   },\n    // },\n    validateWatcher() {\n      this.blured = true;\n    },\n    focusWatcher() {\n      this.$refs.input.focus();\n    },\n  },\n  methods: {\n    change() {\n      this.activeHint = [];\n      this.activeHintItem = {};\n\n      if (this.controlValue.length >= this.control.count) {\n        const state = this;\n\n        let a = window.BX.ajax.runComponentAction(this.control.action, {\n          sessionid: 'id',\n          userid: 'id',\n        });\n\n        a.then(\n          (result) => {\n            resultFn(state, result);\n          },\n          (error) => {\n            if (window.twinpx.vue.markup) {\n              resultFn(state, [\n                {\n                  id: 'id1',\n                  value: '456456',\n                },\n                {\n                  id: 'id2',\n                  value: '123133',\n                },\n                {\n                  id: 'id3',\n                  value: '798798',\n                },\n              ]);\n            } else {\n              //showError(error)\n            }\n          }\n        );\n\n        function resultFn(state, data) {\n          state.hintItems = data;\n        }\n      } else {\n        this.hintItems = [];\n      }\n    },\n    upArrow() {\n      let activeIndex = this.activeHint.indexOf(true);\n      let arr = this.activeHint.map((elem) => null);\n\n      if (activeIndex >= 0) {\n        this.activeHint[activeIndex] = null;\n      }\n      if (--activeIndex < 0) {\n        activeIndex = this.activeHint.length - 1;\n      }\n      arr[activeIndex] = true;\n      //lightlight hint\n      this.activeHint = arr;\n      //set active user\n      this.activeHintItem =\n        this.users.find((user) => user.ORNZ === this.controlValue) || {};\n    },\n    downArrow() {\n      let activeIndex = this.activeHint.indexOf(true);\n      let arr = this.activeHint.map((elem) => null);\n      if (activeIndex >= 0) {\n        this.activeHint[activeIndex] = null;\n      }\n      if (++activeIndex > this.activeHint.length - 1) {\n        activeIndex = 0;\n      }\n      arr[activeIndex] = true;\n      //lightlight hint\n      this.activeHint = arr;\n      //set active user\n      this.activeHintItem =\n        this.users.find((user) => user.ORNZ === this.controlValue) || {};\n    },\n    focus() {\n      this.focused = true;\n      this.blured = false;\n\n      this.compare = this.controlValue;\n    },\n    blur() {\n      this.focused = false;\n      this.blured = true;\n\n      setTimeout(() => {\n        this.hintItems = [];\n      }, 200);\n\n      setTimeout(() => {\n        this.validate();\n      }, 100);\n\n      if (this.controlValue !== this.compare) {\n        this.$emit('autosave');\n        bitrixLogs(6, `${this.formControl.label}: ${this.controlValue}`);\n      }\n    },\n    validate() {\n      if (\n        (this.control.required && this.value.trim()) ||\n        !this.control.required\n      ) {\n        if (this.control.regexp) {\n          const match = String(this.value.trim()).match(\n            RegExp(this.control.regexp)\n          );\n          if (!match) {\n            this.warning = this.control.regexp_description;\n          } else {\n            this.warning = '';\n          }\n          return match;\n        } else {\n          return true;\n        }\n      } else if (this.control.required && !this.value) {\n        return false;\n      }\n      return true;\n    },\n  },\n};\n"],"names":["ControlHint","data","controlId","id","control","controlName","name","focused","blured","warning","hint","hint_external","controlValue","value","hintItems","activeHintItem","activeHint","hover","compare","props","template","emits","computed","placeholder","trim","hint_internal","active","invalid","validate","disabled","validateWatcher","focusWatcher","isClearable","watch","$refs","input","focus","methods","change","length","count","resultFn","state","a","window","BX","ajax","runComponentAction","action","sessionid","userid","then","result","error","twinpx","vue","markup","upArrow","activeIndex","indexOf","arr","map","elem","users","find","user","ORNZ","downArrow","blur","setTimeout","$emit","bitrixLogs","formControl","label","required","regexp","match","String","RegExp","regexp_description"],"mappings":"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"}
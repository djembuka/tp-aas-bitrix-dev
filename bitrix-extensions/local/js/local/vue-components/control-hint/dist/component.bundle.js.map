{"version":3,"file":"component.bundle.js","sources":["../src/component.js"],"sourcesContent":["import './component.css';\r\n\r\nexport const ControlHint = {\r\n  data() {\r\n    return {\r\n      controlId: this.id || this.control.id || null,\r\n      controlName: this.name || this.control.name || null,\r\n      focused: false,\r\n      blured: false,\r\n      warning: '',\r\n      hint: this.control.hint_external,\r\n\r\n      showHints: false,\r\n      activeHintItem: {},\r\n      activeHintArray: [],\r\n      hover: false,\r\n      compare: this.controlValue,\r\n      memoryValue: '',\r\n    };\r\n  },\r\n  props: ['control', 'id', 'name'],\r\n  // language=Vue\r\n  template: `\r\n\t\t<div\r\n      :class=\"{\r\n        'twpx-form-control': true,\r\n        'twpx-form-control--hint': true,\r\n        'twpx-form-control--active': active,\r\n        'twpx-form-control--invalid': invalid,\r\n        'twpx-form-control--disabled': disabled,\r\n      }\"\r\n    >\r\n      <img\r\n        :src=\"disabled\"\r\n        class=\"twpx-form-control__disabled-icon\"\r\n        v-if=\"false\"\r\n      />\r\n\r\n      <div class=\"twpx-form-control__label\">{{ control.label }}</div>\r\n      \r\n      <input\r\n        type=\"text\"\r\n        :id=\"controlId\"\r\n        :name=\"controlName\"\r\n        v-model=\"controlValue\"\r\n        @focus=\"focus\"\r\n        @blur=\"blur\"\r\n        @keydown.enter.prevent=\"enterInput\"\r\n        @keydown.up.prevent=\"upArrow()\"\r\n        @keydown.down.prevent=\"downArrow()\"\r\n        :disabled=\"disabled\"\r\n        ref=\"input\"\r\n        autocomplete=\"off\"\r\n        :placeholder=\"placeholder\"\r\n        class=\"twpx-form-control__input\"\r\n      />\r\n\r\n      <div class=\"b-input-clear\" @click.prevent=\"clearInput()\" v-show=\"isClearable\"></div>\r\n\r\n      <div class=\"b-input-hint\" v-if=\"showHints\">\r\n        <div v-for=\"(hint, index) in hintItems\" :data-id=\"hint.id\" :data-value=\"hint.value\" :class=\"{active: activeHintArray[index]}\" class=\"b-input-hint__item\" @click.prevent=\"clickHint(hint)\">{{ hint.value }}</div>\r\n      </div>\r\n\r\n      <div\r\n        class=\"twpx-form-control__warning\"\r\n        v-html=\"warning\"\r\n        v-if=\"warning\"\r\n      ></div>\r\n\r\n      <div class=\"twpx-form-control__hint\" v-html=\"hint\" v-if=\"hint\"></div>\r\n    </div>\r\n\t`,\r\n  emits: ['input'],\r\n  computed: {\r\n    hintItems() {\r\n      return this.control.hints;\r\n    },\r\n    placeholder() {\r\n      if (this.focused && (!this.controlValue || !this.controlValue.trim())) {\r\n        return this.control.hint_internal;\r\n      } else {\r\n        return '';\r\n      }\r\n    },\r\n    active() {\r\n      return this.focused || !!this.controlValue.trim();\r\n    },\r\n    invalid() {\r\n      return this.blured && !this.validate();\r\n    },\r\n    disabled() {\r\n      return this.control.disabled;\r\n    },\r\n    validateWatcher() {\r\n      return this.control.validateWatcher;\r\n    },\r\n    focusWatcher() {\r\n      return this.control.focusWatcher;\r\n    },\r\n    isClearable() {\r\n      return this.controlValue !== '' && this.hover ? true : false;\r\n    },\r\n    controlValue: {\r\n      get() {\r\n        if (typeof this.control.value === 'object') {\r\n          return this.control.value.value;\r\n        }\r\n        return this.control.value;\r\n      },\r\n      set(value) {\r\n        this.$emit('input', { value });\r\n\r\n        // this.activeHintArray = [];\r\n        // this.activeHintItem = {};\r\n\r\n        if (this.controlValue.length >= this.control.count) {\r\n          this.$emit('input', { hintsAction: this.control.action });\r\n        } else {\r\n          this.showHints = false;\r\n        }\r\n      },\r\n    },\r\n  },\r\n  watch: {\r\n    hintItems() {\r\n      this.activeHintArray = this.hintItems.map(() => null);\r\n    },\r\n    controlValue() {\r\n      if (\r\n        this.controlValue.length >= this.control.count &&\r\n        typeof this.control.hints === 'object' &&\r\n        this.control.hints.length &&\r\n        !this.loading\r\n      ) {\r\n        console.log(1);\r\n        this.showHints = true;\r\n      }\r\n    },\r\n    validateWatcher() {\r\n      this.blured = true;\r\n    },\r\n    focusWatcher() {\r\n      this.$refs.input.focus();\r\n    },\r\n  },\r\n  methods: {\r\n    enterInput() {\r\n      //check if there is an active hint\r\n      let activeIndex = this.activeHintArray.indexOf(true);\r\n      if (activeIndex >= 0) {\r\n        this.activeHintItem = this.hintItems[activeIndex] || {};\r\n      } else {\r\n        //if not\r\n        this.activeHintItem =\r\n          this.hintItems.find(\r\n            (hint) => hint.value.search(this.controlValue) >= 0\r\n          ) || {};\r\n      }\r\n      this.controlValue = this.activeHintItem.value || this.memoryValue;\r\n      this.memoryValue = this.controlValue;\r\n      this.showHints = false;\r\n    },\r\n    clickHint(hint) {\r\n      this.activeHintItem = this.hintItems.find((h) => h.id === hint.id) || {};\r\n      this.$emit('input', { value: hint });\r\n      this.showHints = false;\r\n\r\n      // this.validate();\r\n    },\r\n    upArrow() {\r\n      let activeIndex = this.activeHintArray.indexOf(true);\r\n      let arr = this.activeHintArray.map((elem) => null);\r\n\r\n      if (activeIndex >= 0) {\r\n        this.activeHintArray[activeIndex] = null;\r\n      }\r\n      if (--activeIndex < 0) {\r\n        activeIndex = this.activeHintArray.length - 1;\r\n      }\r\n      arr[activeIndex] = true;\r\n      //lightlight hint\r\n      this.activeHintArray = arr;\r\n      //set active user\r\n      this.activeHintItem =\r\n        this.hintItems.find((hint) => hint.value === this.controlValue) || {};\r\n    },\r\n    downArrow() {\r\n      let activeIndex = this.activeHintArray.indexOf(true);\r\n      console.log(activeIndex);\r\n      let arr = this.activeHintArray.map((elem) => null);\r\n      if (activeIndex >= 0) {\r\n        this.activeHintArray[activeIndex] = null;\r\n      }\r\n      if (++activeIndex > this.activeHintArray.length - 1) {\r\n        activeIndex = 0;\r\n      }\r\n      arr[activeIndex] = true;\r\n      //lightlight hint\r\n      this.activeHintArray = arr;\r\n      //set active user\r\n      this.activeHintItem =\r\n        this.hintItems.find((hint) => hint.value === this.controlValue) || {};\r\n    },\r\n    focus() {\r\n      this.focused = true;\r\n      this.blured = false;\r\n\r\n      this.compare = this.controlValue;\r\n    },\r\n    blur() {\r\n      this.focused = false;\r\n      this.blured = true;\r\n\r\n      setTimeout(() => {\r\n        this.showHints = false;\r\n      }, 200);\r\n\r\n      setTimeout(() => {\r\n        this.validate();\r\n      }, 100);\r\n\r\n      if (typeof this.control.value !== 'object' && !this.showHints) {\r\n        this.controlValue = '';\r\n      }\r\n\r\n      // if (this.controlValue !== this.compare) {\r\n      //   this.$emit('autosave');\r\n      //   bitrixLogs(6, `${this.formControl.label}: ${this.controlValue}`);\r\n      // }\r\n    },\r\n    validate() {\r\n      if (\r\n        (this.control.required && this.value.trim()) ||\r\n        !this.control.required\r\n      ) {\r\n        if (this.control.regexp) {\r\n          const match = String(this.value.trim()).match(\r\n            RegExp(this.control.regexp)\r\n          );\r\n          if (!match) {\r\n            this.warning = this.control.regexp_description;\r\n          } else {\r\n            this.warning = '';\r\n          }\r\n          return match;\r\n        } else {\r\n          return true;\r\n        }\r\n      } else if (this.control.required && !this.value) {\r\n        return false;\r\n      }\r\n      return true;\r\n    },\r\n  },\r\n};\r\n"],"names":["ControlHint","data","controlId","id","control","controlName","name","focused","blured","warning","hint","hint_external","showHints","activeHintItem","activeHintArray","hover","compare","controlValue","memoryValue","props","template","emits","computed","hintItems","hints","placeholder","trim","hint_internal","active","invalid","validate","disabled","validateWatcher","focusWatcher","isClearable","get","value","set","$emit","length","count","hintsAction","action","watch","map","loading","console","log","$refs","input","focus","methods","enterInput","activeIndex","indexOf","find","search","clickHint","h","upArrow","arr","elem","downArrow","blur","setTimeout","required","regexp","match","String","RegExp","regexp_description"],"mappings":"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"}
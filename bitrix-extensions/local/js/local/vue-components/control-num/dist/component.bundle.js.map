{"version":3,"file":"component.bundle.js","sources":["../src/IconLock.js","../src/component.js"],"sourcesContent":["export const IconLock = {\r\n  template: `\r\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"12\" height=\"16\" viewBox=\"0 0 12 16\" fill=\"none\">\r\n      <path d=\"M2.25 5.66667V5C2.25 2.78413 3.92262 1 6 1C8.07738 1 9.75 2.78413 9.75 5V5.66667M2.25 5.66667C1.5625 5.66667 1 6.26667 1 7V13.6667C1 14.4 1.5625 15 2.25 15H9.75C10.4375 15 11 14.4 11 13.6667V7C11 6.26667 10.4375 5.66667 9.75 5.66667M2.25 5.66667H9.75\" stroke=\"#9B9B9B\" stroke-width=\"1.5\" stroke-linecap=\"round\"/>\r\n    </svg>\r\n  `,\r\n};\r\n","import { IconLock } from './IconLock.js';\r\n\r\nimport './component.css';\r\n\r\nexport const ControlNum = {\r\n  props: {\r\n    control: {\r\n      type: Object,\r\n      required: true,\r\n    },\r\n    id: {\r\n      type: String,\r\n      default: null,\r\n    },\r\n    name: {\r\n      type: String,\r\n      default: null,\r\n    },\r\n  },\r\n  data() {\r\n    // Проверяем существование control и его свойств\r\n    if (!this.control) {\r\n      console.error('ControlNum: prop \"control\" is required');\r\n      return {};\r\n    }\r\n\r\n    return {\r\n      controlId: this.id || this.control.id || null,\r\n      controlName: this.name || this.control.name || null,\r\n      focused: false,\r\n      blured: false,\r\n      warning: '',\r\n      hint: this.control?.hint_external || '',\r\n    };\r\n  },\r\n  components: {\r\n    IconLock,\r\n  },\r\n  // language=Vue\r\n  template: `\r\n\t\t<div\r\n      :class=\"{\r\n        'twpx-form-control': true,\r\n        'twpx-form-control--num': true,\r\n        'twpx-form-control--active': active,\r\n        'twpx-form-control--invalid': invalid,\r\n        'twpx-form-control--disabled': disabled,\r\n      }\"\r\n    >\r\n      <IconLock\r\n        class=\"twpx-form-control__disabled-icon\"\r\n        v-if=\"disabled\"\r\n      />\r\n      <div class=\"twpx-form-control__label\">{{ label }}</div>\r\n      <input\r\n        type=\"text\"\r\n        :id=\"controlId\"\r\n        :name=\"controlName\"\r\n        v-model=\"value\"\r\n        @focus=\"focus\"\r\n        @blur=\"blur\"\r\n        @keyup.enter=\"enter\"\r\n        @keydown=\"keydown\"\r\n        :disabled=\"disabled\"\r\n        ref=\"input\"\r\n        autocomplete=\"off\"\r\n        :placeholder=\"placeholder\"\r\n        :aria-label=\"label\"\r\n        :aria-invalid=\"invalid\"\r\n        class=\"twpx-form-control__input\"\r\n      />\r\n      <div\r\n        class=\"twpx-form-control__warning\"\r\n        v-html=\"warning\"\r\n        v-if=\"warning\"\r\n      ></div>\r\n      <div class=\"twpx-form-control__hint\" v-html=\"hint\" v-if=\"hint\"></div>\r\n    </div>\r\n\t`,\r\n  emits: ['input', 'focus', 'blur', 'enter'],\r\n  computed: {\r\n    label() {\r\n      if (this.control.required && !this.control.label.includes('*')) {\r\n        return `${this.control.label} *`\r\n      }\r\n      return this.control.label;\r\n    },\r\n    value: {\r\n      get() {\r\n        const value = isNaN(Number(this.control?.value)) ? 0 : this.control?.value;\r\n        return value || '';\r\n      },\r\n      set(value) {\r\n        if (!this.control) return;\r\n        this.control.setInvalidWatcher = false;\r\n        this.$emit('input', { value });\r\n      },\r\n    },\r\n    placeholder() {\r\n      if (this.focused && !String(this.value).trim()) {\r\n        return this.control?.hint_internal || '';\r\n      }\r\n      return '';\r\n    },\r\n    active() {\r\n      return this.focused || !!String(this.control?.value)?.trim();\r\n    },\r\n    invalid() {\r\n      return (this.blured && !this.validate()) || this.setInvalidWatcher;\r\n    },\r\n    disabled() {\r\n      return !!this.control?.disabled;\r\n    },\r\n    validateWatcher() {\r\n      return this.control.validateWatcher;\r\n    },\r\n    focusWatcher() {\r\n      return this.control.focusWatcher;\r\n    },\r\n    setInvalidWatcher() {\r\n      return this.control.setInvalidWatcher;\r\n    },\r\n  },\r\n  watch: {\r\n    validateWatcher() {\r\n      this.blured = true;\r\n    },\r\n    focusWatcher() {\r\n      this.$refs.input.focus();\r\n    },\r\n    setInvalidWatcher(val) {\r\n      this.warning = val ? this.control.regexp_description : '';\r\n    },\r\n  },\r\n  methods: {\r\n    focus() {\r\n      this.focused = true;\r\n      this.blured = false;\r\n      this.$emit('focus');\r\n    },\r\n    blur() {\r\n      this.focused = false;\r\n      this.blured = true;\r\n      this.$emit('blur');\r\n    },\r\n    enter() {\r\n      this.$emit('enter');\r\n    },\r\n    keydown($event) {\r\n      this.inputnum($event);\r\n    },\r\n    inputnum(e) {\r\n      const key = e.key;\r\n      const allowedChar = /[0-9.,]/;\r\n\r\n      const controlKeys = [\r\n        'Backspace',\r\n        'Delete',\r\n        'Tab',\r\n        'Escape',\r\n        'Enter',\r\n        'Home',\r\n        'End',\r\n        'ArrowLeft',\r\n        'ArrowRight',\r\n        'ArrowUp',\r\n        'ArrowDown',\r\n      ];\r\n\r\n      // Разрешаем навигацию/редактирование и сочетания клавиш (копировать/вставить и т.п.)\r\n      if (controlKeys.includes(key) || e.ctrlKey || e.metaKey) {\r\n        return;\r\n      }\r\n\r\n      // Разрешаем только одну запятую или точку в значении\r\n      if (key === '.' || key === ',') {\r\n        const currentValue = this.value || '';\r\n        const hasSeparator = currentValue.includes('.') || currentValue.includes(',');\r\n\r\n        if (hasSeparator) {\r\n          const inputEl = this.$refs.input;\r\n          const selStart = inputEl && typeof inputEl.selectionStart === 'number' ? inputEl.selectionStart : null;\r\n          const selEnd = inputEl && typeof inputEl.selectionEnd === 'number' ? inputEl.selectionEnd : null;\r\n\r\n          // Разрешаем ввод, только если в выделении уже есть разделитель (тем самым заменяем его)\r\n          if (selStart !== null && selEnd !== null && selStart !== selEnd) {\r\n            const selectedText = currentValue.slice(selStart, selEnd);\r\n            const selectionHasSeparator = selectedText.includes('.') || selectedText.includes(',');\r\n            if (!selectionHasSeparator) {\r\n              e.preventDefault();\r\n              return;\r\n            }\r\n          } else {\r\n            e.preventDefault();\r\n            return;\r\n          }\r\n        }\r\n      }\r\n\r\n      // Разрешаем только цифры, точку и запятую\r\n      if (!allowedChar.test(key)) {\r\n        e.preventDefault();\r\n      }\r\n    },\r\n    validate() {\r\n      if (\r\n        (this.control.required && String(this.value).trim()) ||\r\n        !this.control.required\r\n      ) {\r\n        if (this.control.regexp) {\r\n          const match = String(this.value).trim().match(\r\n            RegExp(this.control.regexp)\r\n          );\r\n          if (!match) {\r\n            this.warning = this.control.regexp_description;\r\n          } else {\r\n            this.warning = '';\r\n          }\r\n          return match;\r\n        } else {\r\n          return true;\r\n        }\r\n      } else if (this.control.required && !this.value) {\r\n        return false;\r\n      }\r\n      return true;\r\n    },\r\n  },\r\n  created() {\r\n    // Проверка обязательных свойств control при создании компонента\r\n    const requiredProps = ['value', 'label'];\r\n    requiredProps.forEach((prop) => {\r\n      if (!(prop in this.control)) {\r\n        console.warn(\r\n          `ControlNum: Missing required control property \"${prop}\"`\r\n        );\r\n      }\r\n    });\r\n  },\r\n};\r\n"],"names":["IconLock","template","ControlNum","props","control","type","Object","required","id","String","name","data","console","error","controlId","controlName","focused","blured","warning","hint","hint_external","components","emits","computed","label","includes","value","get","isNaN","Number","set","setInvalidWatcher","$emit","placeholder","trim","hint_internal","active","invalid","validate","disabled","validateWatcher","focusWatcher","watch","$refs","input","focus","val","regexp_description","methods","blur","enter","keydown","$event","inputnum","e","key","allowedChar","controlKeys","ctrlKey","metaKey","currentValue","hasSeparator","inputEl","selStart","selectionStart","selEnd","selectionEnd","selectedText","slice","selectionHasSeparator","preventDefault","test","regexp","match","RegExp","created","requiredProps","forEach","prop","warn"],"mappings":"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"}
{"version":3,"file":"application.bundle.js","sources":["../src/components/candidate-component.js","../src/stores/data.js","../src/components/application.js","../src/loader.js"],"sourcesContent":["import { DocComponent } from 'local.vue-components.doc-component';\r\n\r\nexport const CandidateComponent = {\r\n    data() {\r\n        return {\r\n            print: false\r\n        }\r\n    },\r\n    props: ['lang', 'groups', 'candidate'],\r\n    emits: ['printGroup'],\r\n    components: {\r\n        DocComponent\r\n    },\r\n    template: `\r\n        <h2 v-if=\"group && print\">{{ group.title }}</h2>\r\n        <div class=\"twpx-poll-candidates-item\" v-if=\"candidate\">\r\n            <div class=\"twpx-poll-candidates-item__info\">\r\n                <span class=\"twpx-poll-candidates-item__img\">\r\n                    <img :src=\"candidate.img\" :alt=\"candidate.name\">\r\n                </span>\r\n                <div class=\"twpx-poll-candidates-item__text\">\r\n                    <h3 v-if=\"candidate.name\">{{ candidate.name }}</a></h3>\r\n                    <div class=\"twpx-poll-candidates-item__description\" v-if=\"candidate.description\" v-html=\"candidate.description\"></div>\r\n                </div>\r\n            </div>\r\n            <div class=\"twpx-poll-candidates-item__docs\">\r\n                <DocComponent v-for=\"doc in candidate.docs\" :key=\"doc.id\"  :doc=\"doc\" />\r\n            </div>\r\n        </div>\r\n    `,\r\n    computed: {\r\n        group() {\r\n            return this.groups.find(g => String(g.id) === String(this.candidate.group));\r\n        }\r\n    },\r\n    beforeMount() {\r\n        if (this.group && !this.group.printed) {\r\n            this.print = true;\r\n            this.$emit('printGroup', this.group);\r\n        }\r\n        \r\n    }\r\n};","import { defineStore } from 'ui.vue3.pinia';\n\nexport const dataStore = defineStore('data', {\n  state: () => ({\n    customData: {},\n    signedParameters: '',\n    actions: [],\n\n    lang: {},\n    loading: false,\n    error: '',\n\n    groups: [],\n    candidates: [],\n  }),\n  actions: {\n    printGroup(group) {\n      group.printed = true;\n    },\n    changeProp(prop, value) {\n      this[prop] = value;\n    },\n    runBitrixMethod(method, data, formData) {\n      if (!this.actions[method] || !Array.isArray(this.actions[method])) {\n        return Promise.reject({errors: [{message: `No such method ${method}`}]});\n      }\n\n      let payload;\n      \n      // Если есть formData, добавляем к нему customData и передаем как data\n      if (formData instanceof FormData) {\n        // Добавляем customData к FormData\n        Object.entries(this.customData).forEach(([key, value]) => {\n          if (value !== undefined && value !== null) {\n            formData.append(key, value);\n          }\n        });\n        payload = formData;\n      } else if (data) {\n        // Если есть data, объединяем с customData в объект\n        payload = {\n          ...this.customData,\n          ...data\n        };\n      } else {\n        // Если нет ни data, ни formData, передаем только customData\n        payload = this.customData;\n      }\n\n      return BX.ajax.runComponentAction(this.actions[method][0], this.actions[method][1], {\n        mode: 'class',\n        data: payload,\n        signedParameters: this.signedParameters,\n      })\n    }\n  }\n});\n","import './application.css';\r\n\r\nimport { CandidateComponent } from './candidate-component';\r\n\r\nimport { LoaderCircle } from 'local.vue-components.loader-circle';\r\nimport { MessageComponent } from 'local.vue-components.message-component';\r\n\r\nimport { mapState, mapActions } from 'ui.vue3.pinia';\r\nimport { dataStore } from '../stores/data';\r\n\r\nexport const Application = {\r\n  data() {\r\n    return {};\r\n  },\r\n  components: {\r\n    LoaderCircle,\r\n    MessageComponent,\r\n    CandidateComponent\r\n  },\r\n  template: `\r\n    <div class=\"twpx-voting-client__loader\" v-if=\"loading\">\r\n        <LoaderCircle :show=\"loading\" />\r\n    </div>\r\n\r\n    <MessageComponent v-else-if=\"error\" type=\"error\" size=\"big\" :message=\"error\" />\r\n\r\n    <div v-if=\"groups && candidates\" class=\"twpx-poll-candidates\">\r\n\r\n      <CandidateComponent v-for=\"candidate in candidates\"\r\n        :key=\"candidate.id\"\r\n        :lang=\"lang\"\r\n        :groups=\"groups\"\r\n        :candidate=\"candidate\"\r\n        @printGroup=\"printGroup\"\r\n      />\r\n\r\n    </div>\r\n\t`,\r\n  computed: {\r\n    ...mapState(dataStore, [\r\n      'lang',\r\n      'loading',\r\n      'error',\r\n\r\n      'groups',\r\n      'candidates'\r\n    ]),\r\n  },\r\n  methods: {\r\n    ...mapActions(dataStore, [\r\n      'runBitrixMethod',\r\n      'changeProp',\r\n      'printGroup'\r\n    ]),\r\n  },\r\n  async mounted() {\r\n    try {\r\n      const groupsResult = await this.runBitrixMethod('getGroups', {});\r\n      this.changeProp('groups', groupsResult.data);\r\n\r\n      const candidatesResult = await this.runBitrixMethod('getCandidates', {});\r\n      this.changeProp('candidates', candidatesResult.data);\r\n    } catch(error) {\r\n        this.changeProp('loading', false)\r\n        this.changeProp('error', error.errors[0].message)\r\n    }\r\n  },\r\n};\r\n","import { BitrixVue } from 'ui.vue3';\r\nimport { Application } from './components/application';\r\nimport { createPinia, setActivePinia } from 'ui.vue3.pinia';\r\nimport { dataStore } from './stores/data';\r\n\r\nexport class VotingCandidates {\r\n  #store;\r\n  #rootNode;\r\n  #application;\r\n\r\n  constructor(rootNode, options) {\r\n    this.#store = createPinia();\r\n    this.#rootNode = document.querySelector(rootNode);\r\n    this.options = options;\r\n  }\r\n\r\n  run() {\r\n    const self = this;\r\n\r\n    this.#application = BitrixVue.createApp({\r\n      name: 'PollCandidates',\r\n      components: {\r\n        Application,\r\n      },\r\n      template: '<Application/>',\r\n      beforeMount() {\r\n        dataStore().customData = self.options.data || {};\r\n        dataStore().signedParameters = self.options.signedParameters || '';\r\n\r\n        dataStore().lang = self.options.lang || {};\r\n        dataStore().actions = self.options.actions || [];\r\n      },\r\n    });\r\n\r\n    this.#application.use(this.#store);\r\n    this.#application.mount(this.#rootNode);\r\n  }\r\n\r\n  initStorageBeforeStartApplication() {\r\n    setActivePinia(this.#store);\r\n  }\r\n\r\n  getTableStore() {\r\n    return tableStore;\r\n  }\r\n}\r\n"],"names":["CandidateComponent","data","print","props","emits","components","DocComponent","template","computed","group","groups","find","g","String","id","candidate","beforeMount","printed","$emit","dataStore","defineStore","state","customData","signedParameters","actions","lang","loading","error","candidates","printGroup","changeProp","prop","value","runBitrixMethod","method","formData","Array","isArray","Promise","reject","errors","message","payload","FormData","Object","entries","forEach","key","undefined","append","BX","ajax","runComponentAction","mode","Application","LoaderCircle","MessageComponent","mapState","methods","mapActions","mounted","groupsResult","candidatesResult","VotingCandidates","rootNode","options","createPinia","document","querySelector","self","BitrixVue","createApp","name","use","mount","setActivePinia","tableStore"],"mappings":"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"}